<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/bower_components/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript">
      function visualizeDeviceorientation(data) {
        // gamma is the left-to-right tilt in degrees, where right is positive // 90
        var tiltLR = data.data.gamma;

        // beta is the front-to-back tilt in degrees, where front is positive // 180
        var tiltFB = data.data.beta;

        // alpha is the compass direction the device is facing in degrees
        var dir = data.data.alpha
      }

      var socket = io.connect('http://'+window.location.hostname+':'+window.location.port);

      if (window.DeviceOrientationEvent) {
        socket.emit('registerController');
        socket.on('registeredController', function(controller){
          window.addEventListener('deviceorientation', function(data) {
            socket.emit('deviceorientation', data);
            visualizeDeviceorientation({controller: controller, data: data});
          }, false);
        });
      }

      function resizeCanvas() {
        $('#canvas')
          .attr('width', document.documentElement.clientWidth)
          .attr('height', document.documentElement.clientHeight);
      }

      function drawCursor(ctx, x, y) {
        ctx.clearRect(0,0,window.innerWidth, window.innerHeight);
        ctx.fillStyle = "#FF0000";
        ctx.fillRect(x-10, y, 25, 5);
        ctx.fillRect(x, y-10, 5, 25);
      }

      $(document).ready(function(){
        $(window).on('resize', resizeCanvas);
        resizeCanvas();
        var c = document.getElementById("canvas");
        var ctx = c.getContext("2d");

        socket.on('visualizeDeviceorientation', function(event){
          var x = window.innerWidth - window.innerWidth / 360 * (event.data.alpha);
          var y = window.innerHeight - window.innerHeight / 360 * (event.data.beta + 180);
          drawCursor(ctx, x, y);
        });

        // window.addEventListener('deviceorientation', function(event) {
        //   var x = window.innerHeight / 180 * (event.gamma + 90);
        //   var y = window.innerWidth / 360 * (event.beta + 180);
        //   drawCursor(ctx, x, y);
        // }, false);

      });
    </script>
    <style media="screen">
      body { margin: 0; }
    </style>
  </head>
  <body>
    <canvas id="canvas"></canvas>
  </body>
</html>
